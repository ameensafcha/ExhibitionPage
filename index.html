<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SAFCHA Ultimate Player</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    margin: 0;
  }

  /* Video Container */
  #videoContainer {
    position: relative;
    background: black;
    overflow: hidden;
    width: 100%;
    max-width: 800px;
    aspect-ratio: 16/9;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
    -webkit-tap-highlight-color: transparent;
  }

  #videoContainer.fullscreen-mode {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    z-index: 99999 !important;
    max-width: none !important;
  }

  #videoContainer video {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  /* --- BUTTONS ANIMATION --- */
  .top-btn {
    z-index: 100;
    opacity: 0; 
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s, transform 0.2s;
    transform: scale(0.9);
  }

  /* Show buttons when active */
  #videoContainer.user-active .top-btn {
    opacity: 1;
    visibility: visible;
    transform: scale(1);
  }

  /* Hide EVERYTHING when locked */
  #videoContainer.locked .top-btn#uploadBtn,
  #videoContainer.locked #controls {
    opacity: 0 !important;
    pointer-events: none !important;
  }

  /* Lock button specific */
  #videoContainer.locked.user-active #lockBtn {
    opacity: 1 !important;
    pointer-events: auto !important;
    visibility: visible !important;
  }

  /* --- CONTROLS BAR --- */
  #controls {
    transition: opacity 0.3s ease, transform 0.3s ease;
    opacity: 0; 
    transform: translateY(10px);
    z-index: 50;
  }

  #videoContainer.user-active #controls {
    opacity: 1;
    transform: translateY(0);
  }

  /* Progress Bar */
  input[type=range] {
    -webkit-appearance: none;
    background: transparent;
    height: 20px;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 14px;
    width: 14px;
    border-radius: 50%;
    background: #ffffff;
    margin-top: -5px;
    box-shadow: 0 0 4px rgba(0,0,0,0.5);
  }
  input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
  }
</style>
</head>
<body>

  <div id="videoContainer">
    <video 
      id="videoPlayer"
      autoplay
      muted
      loop
      playsinline
      webkit-playsinline
      poster="https://images.unsplash.com/photo-1574267432644-f610c0b5c135?w=1024"
    >
      <source src="https://res.cloudinary.com/dpgaxuazo/video/upload/v1768309998/ItalyvidPromo_dqbyxo.mp4" type="video/mp4">
      <source src="https://vz-2303aadb-00d.b-cdn.net/75e2266b-f58f-4bed-bf26-d34682b1029f/playlist.m3u8" type="video/mp4">
    </video>

    <input type="file" id="videoInput" accept="video/*" class="hidden">

    <button id="uploadBtn" class="top-btn absolute top-4 left-4 bg-black/40 text-white p-2 rounded-full backdrop-blur-md border border-white/10 hover:bg-white/20">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
    </button>

    <button id="lockBtn" class="top-btn absolute top-4 right-4 bg-black/40 text-white p-2 rounded-full backdrop-blur-md border border-white/10 hover:bg-white/20">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
    </button>

    <div id="controls" class="absolute bottom-2 left-2 right-2 bg-black/70 backdrop-blur-md px-3 py-2 rounded-xl flex items-center gap-2">
      
      <button id="playPauseBtn" class="text-white hover:text-green-400 p-1">
        <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        <svg id="pauseIcon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
      </button>
      
      <span id="currentTime" class="text-white text-[10px] font-mono min-w-[30px] text-center">0:00</span>
      
      <input type="range" id="progress" min="0" max="100" value="0" class="flex-grow h-1 mx-1">
      
      <span id="duration" class="text-white text-[10px] font-mono min-w-[30px] text-center">0:00</span>

      <button id="muteBtn" class="text-white hover:text-green-400 p-1">
        <svg id="volUpIcon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        <svg id="volMuteIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
      </button>

      <button id="fsBtn" class="text-white hover:text-green-400 p-1 border-l border-white/20 pl-2 ml-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
      </button>

    </div>
  </div>

<script>
const video = document.getElementById('videoPlayer');
const container = document.getElementById('videoContainer');
const lockBtn = document.getElementById('lockBtn');
const fsBtn = document.getElementById('fsBtn');
const playPauseBtn = document.getElementById('playPauseBtn');
const playIcon = document.getElementById('playIcon');
const pauseIcon = document.getElementById('pauseIcon');
const progress = document.getElementById('progress');
const currentTimeDisplay = document.getElementById('currentTime');
const durationDisplay = document.getElementById('duration');
const muteBtn = document.getElementById('muteBtn');
const volUpIcon = document.getElementById('volUpIcon');
const volMuteIcon = document.getElementById('volMuteIcon');
const uploadBtn = document.getElementById('uploadBtn');
const videoInput = document.getElementById('videoInput');

let isLocked = false;
let activityTimeout;
let wakeLock = null; 
let lastClickTime = 0; 

// --- 0. FILE UPLOAD LOGIC ---
uploadBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    videoInput.click();
});

videoInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const fileURL = URL.createObjectURL(file);
        video.src = fileURL;
        video.muted = false; // Local files ko unmuted chala sakte hain user action se
        video.play();
        updateUI(true);
    }
});

// --- 1. WAKE LOCK ---
async function requestWakeLock() {
  if ('wakeLock' in navigator) {
    try { wakeLock = await navigator.wakeLock.request('screen'); } 
    catch (err) { console.log('Wake Lock Error:', err); }
  }
}
function releaseWakeLock() {
  if (wakeLock !== null) { wakeLock.release().then(() => { wakeLock = null; }); }
}

// --- 2. VISIBILITY & DOUBLE TAP ---
function showControls() {
  container.classList.add('user-active');
  clearTimeout(activityTimeout);
  activityTimeout = setTimeout(() => {
    if (!video.paused || isLocked) {
      container.classList.remove('user-active');
    }
  }, 3000);
}

function handleContainerClick(e) {
    const currentTime = new Date().getTime();
    const timeDiff = currentTime - lastClickTime;
    if (timeDiff < 300 && timeDiff > 0) {
        if (!isLocked) toggleFullscreen();
    } else {
        showControls();
    }
    lastClickTime = currentTime;
}

container.addEventListener('click', handleContainerClick);
container.addEventListener('touchstart', (e) => showControls());
container.addEventListener('mousemove', showControls);

// --- 3. LOCK LOGIC ---
lockBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  isLocked = !isLocked;
  
  if (isLocked) {
    container.classList.add('locked');
    lockBtn.classList.replace('bg-black/40', 'bg-red-500');
    lockBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`;
  } else {
    container.classList.remove('locked');
    lockBtn.classList.replace('bg-red-500', 'bg-black/40');
    lockBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>`;
  }
  showControls();
});

// --- 4. FULLSCREEN & PLAYER LOGIC ---
fsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleFullscreen(); });

function toggleFullscreen() {
  if (document.fullscreenElement || container.classList.contains('fullscreen-mode')) {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    container.classList.remove('fullscreen-mode');
  } else {
    if (container.requestFullscreen) {
        container.requestFullscreen().catch(() => container.classList.add('fullscreen-mode'));
    } else {
        container.classList.add('fullscreen-mode');
    }
  }
}

window.addEventListener('load', () => {
    // Force Autoplay Logic
    var playPromise = video.play();
    if (playPromise !== undefined) {
        playPromise.then(_ => {
            // Automatic playback started!
            updateUI(true);
        })
        .catch(error => {
            // Auto-play was prevented
            // (Is case me hum kuch ni kr skte, user ko tap krna hoga, 
            // but 'muted' tag se ye error 99% aayega hi nahi)
            console.log("Autoplay prevent, waiting for user.");
        });
    }
    showControls();
});

muteBtn.addEventListener('click', (e) => { e.stopPropagation(); video.muted = !video.muted; updateUI(false); });
playPauseBtn.addEventListener('click', (e) => { e.stopPropagation(); video.paused ? video.play() : video.pause(); });

video.addEventListener('play', () => { updateUI(true); requestWakeLock(); });
video.addEventListener('pause', () => { updateUI(true); releaseWakeLock(); });
video.addEventListener('ended', releaseWakeLock);

function updateUI(updatePlayBtn) {
    if(video.muted) { volUpIcon.classList.add('hidden'); volMuteIcon.classList.remove('hidden'); }
    else { volUpIcon.classList.remove('hidden'); volMuteIcon.classList.add('hidden'); }
    
    if(updatePlayBtn) {
        if(video.paused) { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); }
        else { playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); }
    }
}

video.addEventListener('timeupdate', () => {
  const current = video.currentTime;
  const duration = video.duration || 0;
  if (!isNaN(duration)) {
    progress.value = (current / duration) * 100;
    currentTimeDisplay.textContent = formatTime(current);
    durationDisplay.textContent = formatTime(duration);
  }
});
progress.addEventListener('input', (e) => {
  e.stopPropagation();
  video.currentTime = (progress.value / 100) * video.duration;
});
function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = Math.floor(seconds % 60);
  return `${m}:${s.toString().padStart(2, '0')}`;
}
document.addEventListener('visibilitychange', async () => {
  if (wakeLock !== null && document.visibilityState === 'visible') requestWakeLock();
});
</script>
</body>
</html>